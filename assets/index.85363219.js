var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,a=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&l(e,r,t[r]);if(n)for(var r of n(t))o.call(t,r)&&l(e,r,t[r]);return e},c=(e,n)=>t(e,r(n));import{u as s,a as u,c as f,j as d,r as h,b as p,F as y,R as g,d as m,P as b,C as k,e as v,S as A,f as E,G as C,H as S,I as M,M as T,g as D,h as w,i as x,k as N}from"./vendor.48db9735.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const P=()=>s(),H=u,O=()=>Date.now(),j={PERFECT_KEY_RATE_DEFAULT:5,DURATION_RANGE_FACTOR:10,DIFFICULTY_GAIN_QUOTIENT:8,STEADY_ACCURACY:90,STEADY_SPEED:70},L=1e3/j.PERFECT_KEY_RATE_DEFAULT,I=j.DURATION_RANGE_FACTOR*L-L;function _(e){const t=function(e){if(0===e.length)return 0;return F(e.map((e=>e.prompt.normDifficulty)))}(e),r=function(e){if(e.length<=1)return 0;function t(e,t){let r=100*(t-e-L)/I;return r=Math.max(0,r),r=Math.min(100,r),100-r}return F(e.flatMap(((r,n)=>0===n?[]:[t(e[n-1].keyedAt,e[n].keyedAt)])))}(e),n=function(e){if(0===e.length)return 100;return 100*e.filter((e=>U(e,e.prompt))).length/e.length}(e),i=r*n*t,o=Math.pow(i,1/3);return{assessedAt:O(),difficulty:Math.round(t),speed:Math.round(r),accuracy:Math.round(n),overall:Math.round(o)}}function U(e,t){return e.char===t.char&&e.shift===t.shift&&e.control===t.control&&e.alt===t.alt}function F(e){return e.reduce(((e,t)=>e+t))/e.length}function R(e,t){return[e,function(e){const t=Object.keys(e).flatMap((t=>t.split("").map((r=>[r,e[t]]))));return new Map(t)}(t)]}const K=new Map([R("US Home Keys",{jfkd:15,"ls;a":18}),R("US Letters",{jfkdlsa:15,urieow:23,hgmcxnv:25,zt:26,bqpy:35}),R("US Letters, Symbols",{"jfkdlsa;":15,urieow:23,"ghmc,xnv":25,".z/t":26,"b'qpy[":35,"]\\":40,9302:53,"7584-":55,"=`61":60})]),G=5,Y=6,B=8;function q(e,t,r,n){const i=[{char:"",alt:!1,control:!1,shift:!1,difficulty:0,normDifficulty:0}];t&&i.push(...i.map((e=>c(a({},e),{shift:!0,difficulty:e.difficulty+G})))),r&&i.push(...i.map((e=>c(a({},e),{control:!0,difficulty:e.difficulty+Y})))),n&&i.push(...i.map((e=>c(a({},e),{alt:!0,difficulty:e.difficulty+B}))));let o=[];for(const[u,f]of(l=e,K.get(l)).entries())o.push(...i.map((e=>c(a({},e),{char:u,difficulty:e.difficulty+f}))));var l;o.sort(((e,t)=>e.difficulty===t.difficulty?0:e.difficulty>t.difficulty?1:-1));const s=100/(o.length-1);return o.forEach(((e,t)=>e.normDifficulty=t*s)),o}const z=[["`","~"],["1","!"],["2","@"],["3","#"],["4","$"],["5","%"],["6","^"],["7","&"],["8","*"],["9","("],["0",")"],["-","_"],["=","+"],["[","{"],["]","}"],["\\","|"],[";",":"],["'",'"'],[",","<"],[".",">"],["/","?"],["Backspace","BACKSPACE"]];function $(e){for(const[t,r]of z)if(e===t)return r;return e.toUpperCase()}function Q(e,t){let r,n=0;for(;n<4;){n++;const i=Math.floor(Math.random()*e.length);if(r=e[i],void 0===t.find((e=>e.char===r.char)))return r}return r}const V={keyPrompt:[],keyHistory:[],buffer:[],config:{keySetName:"US Letters",shiftEnabled:!0,controlEnabled:!1,altEnabled:!1,difficultyAutoAdjust:!0,difficultyTarget:10,errorHandlingMode:"Accept"}};W(V);const J=f({name:"main",initialState:V,reducers:{keyPressed(e,t){var r,n,i;const{keyCapture:o}=t.payload;if(0===e.keyPrompt.length)throw new Error("No key prompt to compare");const l=e.keyPrompt[0],s=U(o,l),u=e.config.errorHandlingMode;"Accept"===u||"Buffer"===u&&0===e.buffer.length&&s||"Ignore"===u&&s?(e.keyHistory.push(c(a({},o),{prompt:l})),e.buffer.length=0,e.keyPrompt.shift()):"Buffer"!==u&&"Ignore"!==u||e.buffer.push(o);if(o.keyedAt>=(null!=(n=null==(r=e.assessment)?void 0:r.assessedAt)?n:0)+1200&&(e.assessment=_(e.keyHistory),e.config.difficultyAutoAdjust)){o.keyedAt>=(null!=(i=e.autoAdjustedAt)?i:0)+4e3&&function(e){const t=e.assessment,r="Accept"!==e.config.errorHandlingMode?100:j.STEADY_ACCURACY,n=Math.sqrt(r*j.STEADY_SPEED),i=Math.sqrt(t.accuracy*t.speed),o=(n-i)/j.DIFFICULTY_GAIN_QUOTIENT;let l=e.config.difficultyTarget-o;l=Math.max(0,l),l=Math.min(100,l),l=Math.round(l),console.log(`New difficulty: ${o<0?"-":"+"}${Math.abs(o)} = ${l}`),e.config.difficultyTarget=l,e.autoAdjustedAt=O()}(e)}W(e)},backspaced(e){e.buffer.length=Math.max(e.buffer.length-1,0)},configChanged(e,t){e.config=t.payload,W(e)}}});function W(e){var t;let r=e.keyHistory.length;for(;r>10;)e.keyHistory.shift(),r--;const n=JSON.stringify([e.config.keySetName,e.config.shiftEnabled,e.config.controlEnabled,e.config.altEnabled]);(null==(t=e.cache)?void 0:t.configHash)!==n&&(e.cache={configHash:n,availableKeys:q(e.config.keySetName,e.config.shiftEnabled,e.config.controlEnabled,e.config.altEnabled)},e.keyPrompt.length=0,e.keyHistory.length=0,e.assessment=void 0);let i=e.cache.availableKeys.length-1;i=Math.round((i-1)*e.config.difficultyTarget/100)+1;const o=e.cache.availableKeys.slice(0,i+1);for(;e.keyPrompt.length<6;){const t=Q(o,e.keyPrompt);e.keyPrompt.push(t)}}const{keyPressed:X,backspaced:Z,configChanged:ee}=J.actions;var te=J.reducer;function re(e){function t(t,r){let n="";return t.alt&&(n+=" key-alt"),t.control&&(n+=" key-ctrl"),function(t){return void 0===e.isCorrectFn||e.isCorrectFn(t)}(r)||(n+=" key-error"),n}return d("p",{className:"main-table",children:e.keyDefs.map(((e,r)=>{const n=e.shift?$(e.char):e.char;return d("span",{className:t(e,r),children:n},r)}))})}function ne(e){const t=O,r=h.exports.useMemo((()=>e.value.map((e=>{let t=e.char;return e.shift&&(t=$(t)),t})).join("")),[e.value]),n=h.exports.useCallback((r=>{const n=r.key.trim().toLowerCase();if("backspace"===n||1===n.length){r.preventDefault();const n=r.shiftKey?function(e){for(const[t,r]of z)if(e===r)return t;return e.toLowerCase()}(r.key):r.key;e.onCapture({char:n,alt:r.altKey,control:r.ctrlKey,shift:r.shiftKey,keyedAt:t()})}}),[]),i=h.exports.useRef();return h.exports.useEffect((()=>{var e;return null==(e=i.current)||e.addEventListener("keydown",n,{passive:!1}),()=>{var e;null==(e=i.current)||e.removeEventListener("keydown",n)}}),[i]),h.exports.useEffect((()=>{var t;e.selectAll&&(null==(t=i.current)||t.select())}),[i,e.value,e.selectAll]),d("input",{type:"text",className:"main-input",ref:e=>i.current=null!=e?e:void 0,defaultValue:r})}const ie=["Ignore","Accept","Buffer"],oe=["US Home Keys","US Letters","US Letters, Symbols"];function le(){const e=H((e=>e.main.config)),t=P(),r=h.exports.useCallback((r=>{const n=r.target.textContent,i=c(a({},e),{keySetName:n});t(ee(i)),r.preventDefault()}),[e]),n=oe.map((e=>({key:e,text:e,value:e}))),i=h.exports.useCallback(((r,n)=>{const i=n.value,o=c(a({},e),{[i]:!1===e[i]});t(ee(o)),r.preventDefault()}),[e]),o=h.exports.useCallback(((r,n)=>{const i=c(a({},e),{errorHandlingMode:n.value});t(ee(i)),r.preventDefault()}),[e]),l=h.exports.useCallback((r=>{const n=c(a({},e),{difficultyTarget:Number(r.target.value)});t(ee(n)),r.preventDefault()}),[e]),s=d("input",{type:"range",style:{width:"100%"},value:e.difficultyTarget,min:"0",max:100..toString(),onChange:l});return d("div",{style:{textAlign:"left"},children:p(y,{children:[d(y.Select,{label:"Key Set:",inline:!0,value:e.keySetName,onChange:r,options:n}),p(y.Group,{inline:!0,children:[d("label",{children:"Modifiers:"}),d(g,{inline:"true",value:"shiftEnabled",label:"Shift",toggle:!0,checked:e.shiftEnabled,onChange:i}),"   ",d(g,{inline:"true",value:"altEnabled",label:"Alt",toggle:!0,checked:e.altEnabled,onChange:i})]}),p(y.Group,{inline:!0,children:[d("label",{children:"Errors:"}),ie.map(((t,r)=>p("span",{children:[r>0&&d(m,{children:"   "}),d(g,{label:t,value:t,checked:e.errorHandlingMode===t,onChange:o})]},t)))]}),p(y.Group,{inline:!0,children:[d("label",{children:"Target Difficulty:"}),d(y.Radio,{inline:!0,value:"difficultyAutoAdjust",label:"Auto",toggle:!0,checked:e.difficultyAutoAdjust,onChange:i})]}),d(b,{content:e.difficultyTarget.toString(),position:"right center",trigger:s})]})})}function ae(){var e;const t=H((e=>e.main.assessment));return d("table",{children:d("tbody",{children:p("tr",{children:[d("td",{children:d(k,{height:120,chartType:"Gauge",loader:d("div",{children:"Loading Chart"}),data:[["Label","Value"],["Overall",null!=(e=null==t?void 0:t.overall)?e:0]],options:{redFrom:90,redTo:100,yellowFrom:75,yellowTo:90,minorTicks:5}})}),d("td",{children:p("p",{children:["Speed: ",null==t?void 0:t.speed,d("br",{}),"Difficulty: ",null==t?void 0:t.difficulty,d("br",{}),"Accuracy: ",null==t?void 0:t.accuracy,d("br",{}),"Overall: ",null==t?void 0:t.overall,d("br",{})]})})]})})})}function ce(){const e=H((e=>e.main)),t=P(),r=h.exports.useMemo((()=>{const t=e.keyHistory.length,r=Math.max(0,t-6);return e.keyHistory.slice(r)}),[e.keyHistory]),n=h.exports.useCallback((e=>{const t=r[e];return U(t,t.prompt)}),[e.keyHistory]);return p("div",{children:[d(v,{position:"left",children:d(le,{})}),d("table",{className:"main-table",children:p("tbody",{children:[p("tr",{children:[d("td",{align:"right",width:"1*",children:d(re,{keyDefs:r.map((e=>e.prompt))})}),d("td",{align:"left",className:"borders",children:d(re,{keyDefs:e.keyPrompt})})]}),p("tr",{children:[d("td",{align:"right",width:"1*",children:d(re,{keyDefs:r,isCorrectFn:n})}),d("td",{children:d(ne,{onCapture:e=>{"backspace"===e.char.toLowerCase()?t(Z()):t(X({keyCapture:e}))},value:e.buffer,selectAll:"Ignore"===e.config.errorHandlingMode})})]})]})}),d(v,{position:"right",children:d(A,{children:d(ae,{})})})]})}function se(){const[e,t]=E.useState(!1);return d("div",{className:"App",children:d(C,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:p(C.Column,{style:{maxWidth:450},children:[p(S,{as:"h2",color:"teal",textAlign:"center",children:[d(M,{src:"/logo.png"})," Arketyper"]}),p(A,{stacked:!0,children:[d(ce,{}),d("div",{style:{textAlign:"right"},children:p(T,{closeIcon:!0,open:e,trigger:d(D,{link:!0,name:"info circle",size:"large"}),onClose:()=>t(!1),onOpen:()=>t(!0),children:[d(S,{icon:"info circle",content:"About Arketyper"}),p(T.Content,{children:[p("p",{children:["Arketyper is designed to gradually improving typing skill on unfamiliar keyboards. See ",d("a",{href:"https://github.com/p33t/arketyper/blob/master/docs/index.md",children:"Online Documentation"})," for more information."]}),p("p",{children:["This is an open-source project ",d("a",{href:"https://github.com/p33t/arketyper",children:"hosted on GitHub"})," and is a ",d("a",{href:"https://www.freshcode.biz",children:"freshcode.biz"})," innovation."]})]})]})})]})]})})})}const ue=w({reducer:{main:te}});x.render(d(E.StrictMode,{children:d(N,{store:ue,children:d(se,{})})}),document.getElementById("root"));
