var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,a=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&i(e,n,t[n]);if(r)for(var n of r(t))o.call(t,n)&&i(e,n,t[n]);return e},c=(e,r)=>t(e,n(r));import{u as s,a as d,c as u,j as h,r as f,b as y,G as g,P as p,F as m,R as b,C as k,B as v,d as E,H as A,I as C,M as _,e as D,S as M,f as N,g as R,h as S}from"./vendor.c7b080b7.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const w=()=>s(),T=d,I=()=>Date.now(),x={PERFECT_KEY_RATE_DEFAULT:5,HISTORY_SIZE_MAX:200,PROMPT_SIZE:5,MOVING_AVERAGE_WINDOW:4,INTERVAL_RANGE_FACTOR:10,KEY_RANGE_GAIN_QUOTIENT:6,KEY_RANGE_DELTA_POSITIVE_MIN:2,KEY_RANGE_DELTA_NEGATIVE_MIN:1,STEADY_ACCURACY:90,STEADY_SPEED:70},H=1e3/x.PERFECT_KEY_RATE_DEFAULT,O=x.INTERVAL_RANGE_FACTOR*H-H;function P(e,t,n){const r=L(e,n)?100:0,l=e.normDifficulty,o=function(e){let t=100*(e-H)/O;return t=Math.max(0,t),t=Math.min(100,t),100-t}(t),i=(a=[r,l,o]).reduce(((e,t)=>e+t))/a.length;var a;return{assessedAt:I(),speed:o,accuracy:r,difficulty:l,overall:i}}function L(e,t){return e.char===t.char&&e.shift===t.shift&&e.control===t.control&&e.alt===t.alt}function K(e,t){return[e,function(e){const t=Object.keys(e).flatMap((t=>t.split("").map((n=>[n,e[t]]))));return new Map(t)}(t)]}const G=new Map([K("US Home Keys",{jf:15,kd:16,"ls;a":18}),K("US Letters",{jf:15,kd:16,lsa:18,urieow:23,hgmcxnv:25,zt:26,bqpy:35}),K("US Letters, Symbols",{jf:15,kd:16,"lsa;":18,urieow:23,"ghmc,xnv":25,".z/t":26,"b'qpy[":35,"]\\":40,9302:53,"7584-":55,"=`61":60})]),j=5,Y=6,V=8;function U(e,t,n,r){const l=[{char:"",alt:!1,control:!1,shift:!1,relativeDifficulty:0,normDifficulty:0}];t&&l.push(...l.map((e=>c(a({},e),{shift:!0,relativeDifficulty:e.relativeDifficulty+j})))),n&&l.push(...l.map((e=>c(a({},e),{control:!0,relativeDifficulty:e.relativeDifficulty+Y})))),r&&l.push(...l.map((e=>c(a({},e),{alt:!0,relativeDifficulty:e.relativeDifficulty+V}))));let o=[];for(const[d,u]of(i=e,G.get(i)).entries())o.push(...l.map((e=>c(a({},e),{char:d,relativeDifficulty:e.relativeDifficulty+u}))));var i;o.sort(((e,t)=>e.relativeDifficulty===t.relativeDifficulty?0:e.relativeDifficulty>t.relativeDifficulty?1:-1));const s=o[o.length-1].relativeDifficulty;return o.forEach(((e,t)=>e.normDifficulty=100*e.relativeDifficulty/s)),o}const F=[["`","~"],["1","!"],["2","@"],["3","#"],["4","$"],["5","%"],["6","^"],["7","&"],["8","*"],["9","("],["0",")"],["-","_"],["=","+"],["[","{"],["]","}"],["\\","|"],[";",":"],["'",'"'],[",","<"],[".",">"],["/","?"],["Backspace","BACKSPACE"]];function B(e){for(const[t,n]of F)if(e===t)return n;return e.toUpperCase()}function z(e,t){let n,r=0;for(;r<4;){r++;const l=Math.floor(Math.random()*e.length);if(n=e[l],void 0===t.find((e=>e.char===n.char)))return n}return n}const $={keyPrompt:[],keyHistory:[],buffer:[],touched:!1,keyChallengeEnabled:!1,config:{keySetName:"US Letters",shiftEnabled:!0,controlEnabled:!1,altEnabled:!1,keyRangeAutoAdjust:!0,keyRange:10,errorHandlingMode:"Ignore"}};Z($);const W=u({name:"main",initialState:$,reducers:{keyPressed(e,t){var n,r,l;e.touched=!0;const{keyCapture:o}=t.payload;if(0===e.keyPrompt.length)throw new Error("No key prompt to compare");const i=e.keyPrompt[0],s=L(o,i),d=e.config.errorHandlingMode,u="Accept"===d||"Buffer"===d&&0===e.buffer.length&&s||"Ignore"===d&&s,h=0===e.keyHistory.length,f=h?void 0:o.keyedAt-e.keyHistory[e.keyHistory.length-1].keyedAt,y=h?void 0:P(i,f,o);u?(e.keyHistory.push(c(a({},o),{prompt:i,assessment:y})),e.buffer.length=0,e.keyPrompt.shift()):"Buffer"!==d&&"Ignore"!==d||e.buffer.push(o);if(e.keyHistory.length>=2&&o.keyedAt>=(null!=(r=null==(n=e.assessment)?void 0:n.assessedAt)?r:e.keyHistory[0].keyedAt)+1200&&(e.assessment=function(e){let t=0,n=0,r=0,l=0,o=0;for(let i=e.length-1;i>=0;i--){const a=e[i];if(a.assessment&&(t++,o=a.assessment.assessedAt,n+=a.assessment.difficulty,r+=a.assessment.speed,l+=a.assessment.accuracy,t===x.MOVING_AVERAGE_WINDOW))break}if(0===t)throw new Error("Cannot summarize because no assessments");return{assessedAt:o,difficulty:n/t,speed:r/t,accuracy:l/t,overall:(r+l+n)/3/t}}(e.keyHistory),e.config.keyRangeAutoAdjust)){o.keyedAt>=(null!=(l=e.autoAdjustedAt)?l:0)+4e3&&function(e){const t=e.assessment,n=(("Accept"===e.config.errorHandlingMode?x.STEADY_ACCURACY:100)+x.STEADY_SPEED)/2;let r=((t.accuracy+t.speed)/2-n)/x.KEY_RANGE_GAIN_QUOTIENT;r>=0?r<x.KEY_RANGE_DELTA_POSITIVE_MIN&&(r=x.KEY_RANGE_DELTA_POSITIVE_MIN):-x.KEY_RANGE_DELTA_NEGATIVE_MIN<r&&(r=-x.KEY_RANGE_DELTA_NEGATIVE_MIN);let l=e.config.keyRange+r;l=Math.max(0,l),l=Math.min(100,l),console.log(`New difficulty: ${r<0?"-":"+"}${Math.abs(r)} = ${l}`),e.config.keyRange=l,e.autoAdjustedAt=I()}(e)}Z(e)},backspaced(e){e.buffer.length=Math.max(e.buffer.length-1,0)},configChanged(e,t){e.touched=!0,e.config=t.payload,Z(e)},resetChallenge(e){e.keyHistory.length=0,e.keyPrompt.length=0,e.buffer.length=0,Z(e)},toggleKeyChallengeEnabled(e){e.keyChallengeEnabled=!e.keyChallengeEnabled}}});function Z(e){var t;let n=e.keyHistory.length;for(;n>x.HISTORY_SIZE_MAX;)e.keyHistory.shift(),n--;const r=JSON.stringify([e.config.keySetName,e.config.shiftEnabled,e.config.controlEnabled,e.config.altEnabled]);(null==(t=e.cache)?void 0:t.configHash)!==r&&(e.cache={configHash:r,availableKeys:U(e.config.keySetName,e.config.shiftEnabled,e.config.controlEnabled,e.config.altEnabled)},e.keyPrompt.length=0,e.keyHistory.length=0,e.assessment=void 0);let l=e.cache.availableKeys.length-1;l=Math.round((l-1)*e.config.keyRange/100)+1;const o=e.cache.availableKeys.slice(0,l+1);for(;e.keyPrompt.length<x.PROMPT_SIZE;){const t=z(o,e.keyPrompt);e.keyPrompt.push(t)}}const{keyPressed:q,backspaced:Q,configChanged:X,resetChallenge:J,toggleKeyChallengeEnabled:ee}=W.actions;var te=W.reducer;function ne(e){function t(t,n){let r="";return t.alt&&(r+=" key-alt"),t.control&&(r+=" key-ctrl"),function(t){return void 0===e.isCorrectFn||e.isCorrectFn(t)}(n)||(r+=" key-error"),r}return h("p",{className:"main-table",children:e.keyDefs.map(((e,n)=>{const r=e.shift?B(e.char):e.char;return h("span",{className:t(e,n),children:r},n)}))})}function re(e){const t=I,n=f.exports.useMemo((()=>e.value.map((e=>{let t=e.char;return e.shift&&(t=B(t)),t})).join("")),[e.value]),r=f.exports.useCallback((n=>{const r=n.key.trim().toLowerCase();if("backspace"===r||1===r.length){n.preventDefault();const r=n.shiftKey?function(e){for(const[t,n]of F)if(e===n)return t;return e.toLowerCase()}(n.key):n.key;e.onCapture({char:r,alt:n.altKey,control:n.ctrlKey,shift:n.shiftKey,keyedAt:t()})}}),[]),l=f.exports.useRef();return f.exports.useEffect((()=>{var e;return null==(e=l.current)||e.addEventListener("keydown",r,{passive:!1}),()=>{var e;null==(e=l.current)||e.removeEventListener("keydown",r)}}),[l]),f.exports.useEffect((()=>{var t;e.selectAll&&(null==(t=l.current)||t.select())}),[l,e.value,e.selectAll]),h("input",{type:"text",className:"main-input",ref:e=>l.current=null!=e?e:void 0,defaultValue:n})}function le(){const e=T((e=>e.main)),t=w(),n=f.exports.useMemo((()=>{const t=e.keyHistory.length,n=Math.max(0,t-6);return e.keyHistory.slice(n)}),[e.keyHistory]),r=f.exports.useCallback((e=>{const t=n[e];return L(t,t.prompt)}),[e.keyHistory]);return y(g,{children:[h(g.Column,{width:8,id:"main-left-col",children:y("div",{style:{textAlign:"right"},children:[h(ne,{keyDefs:n.map((e=>e.prompt))}),h(ne,{keyDefs:n,isCorrectFn:r})]})}),y(g.Column,{width:6,id:"main-right-col",children:[h("div",{className:"borders",children:h(ne,{keyDefs:e.keyPrompt})}),h(p,{inverted:!0,content:"Type the letters above in here",position:"left center",open:!1===e.touched,trigger:h(re,{onCapture:e=>{"backspace"===e.char.toLowerCase()?t(Q()):t(q({keyCapture:e}))},value:e.buffer,selectAll:"Ignore"===e.config.errorHandlingMode})})]})]})}const oe=["Ignore","Accept","Buffer"],ie=["US Home Keys","US Letters","US Letters, Symbols"];function ae(){const e=T((e=>e.main.config)),t=w(),n=f.exports.useCallback((n=>{const r=n.target.textContent,l=c(a({},e),{keySetName:r});t(X(l)),n.preventDefault()}),[e]),r=ie.map((e=>({key:e,text:e,value:e}))),l=f.exports.useCallback(((n,r)=>{const l=r.value,o=c(a({},e),{[l]:!1===e[l]});t(X(o)),n.preventDefault()}),[e]),o=f.exports.useCallback(((n,r)=>{const l=c(a({},e),{errorHandlingMode:r.value});t(X(l)),n.preventDefault()}),[e]),i=f.exports.useCallback((n=>{const r=c(a({},e),{keyRange:Number(n.target.value)});t(X(r)),n.preventDefault()}),[e]),s=h("input",{type:"range",style:{width:"100%"},value:Math.round(e.keyRange),min:"0",max:100..toString(),onChange:i});return h("div",{style:{textAlign:"left"},children:y(m,{children:[h(m.Select,{label:"Key Set:",inline:!0,value:e.keySetName,onChange:n,options:r}),y(m.Group,{inline:!0,children:[h("label",{children:"Modifiers:"}),h(b,{inline:"true",value:"shiftEnabled",label:"Shift",toggle:!0,checked:e.shiftEnabled,onChange:l}),"   ",h(b,{inline:"true",value:"altEnabled",label:"Alt",toggle:!0,checked:e.altEnabled,onChange:l})]}),y(m.Field,{inline:!0,children:[h("label",{children:"Errors: "}),oe.map(((t,n)=>y("span",{children:[h(b,{label:t,value:t,checked:e.errorHandlingMode===t,onChange:o},t),"     "]},t)))]}),y(m.Group,{inline:!0,children:[h("label",{children:"Key Range:"}),h(m.Radio,{inline:!0,value:"keyRangeAutoAdjust",label:"Auto",toggle:!0,checked:e.keyRangeAutoAdjust,onChange:l})]}),h(p,{content:`${e.keyRange}%`,position:"right center",trigger:s})]})})}function ce(){var e,t,n;const r=T((e=>e.main.assessment)),l=f.exports.useMemo((()=>{var e;return Math.round(null!=(e=null==r?void 0:r.overall)?e:0)}),[r]);return h("table",{children:h("tbody",{children:y("tr",{children:[h("td",{children:h(k,{height:120,chartType:"Gauge",loader:h("div",{children:"Loading Chart"}),data:[["Label","Value"],["Overall",l]],options:{redFrom:90,redTo:100,yellowFrom:75,yellowTo:90,minorTicks:5}})}),h("td",{style:{textAlign:"right"},children:y("p",{children:["Speed:",h("br",{}),"Difficulty:",h("br",{}),"Accuracy:",h("br",{}),h("hr",{}),"Overall:",h("br",{})]})}),h("td",{children:y("p",{style:{textAlign:"right"},children:[Math.round(null!=(e=null==r?void 0:r.speed)?e:0),h("br",{}),Math.round(null!=(t=null==r?void 0:r.difficulty)?t:0),h("br",{}),Math.round(null!=(n=null==r?void 0:r.accuracy)?n:0),h("br",{}),h("br",{}),h("strong",{children:l})]})})]})})})}function se(){const e=w(),t=T((e=>e.main.keyHistory)),n=f.exports.useMemo((()=>{var e,n;const r=Math.min(t.length,100)+1,l=Array(r);let o=1-r,i=0,a=t.length-r,c=0;for(l[i]=[o,c];o<0;)c+=null!=(n=null==(e=t[++a].assessment)?void 0:e.overall)?n:0,l[++i]=[++o,c];return 0!==o&&console.log(`final x expected to be 0 but was ${o}`),l}),[t]);const r=h(v,{onClick:function(){e(J())},children:"Reset"});return y(g,{children:[h(g.Column,{width:12,children:h(k,{height:"400px",chartType:"LineChart",loader:h("div",{children:"Loading Chart"}),data:[["x","You"],...n],options:{hAxis:{title:"Latest Keystrokes",minValue:-100,maxValue:0},vAxis:{title:"Cumulative Score",maxValue:1e4,minValue:0},legend:"none"}})}),h(g.Column,{width:4,children:h("table",{width:"100%",children:y("tr",{style:{textAlign:"right"},children:[h("td",{children:y("p",{children:["Count:",h("br",{}),"Total:",h("br",{})]})}),h("td",{children:y("p",{children:[n.length-1,h("br",{}),Math.round(n[n.length-1][1]),h("br",{})]})}),h("td",{children:h(p,{inverted:!0,content:"Start a new challenge",position:"bottom center",open:n.length>100,trigger:r})})]})})})]})}function de(){const[e,t]=E.useState(!1),n=T((e=>e.main.keyChallengeEnabled)),r=w();return h("div",{className:"App ui container",children:y(g,{centered:!0,verticalAlign:"middle",children:[y(g.Row,{children:[h(g.Column,{width:4}),h(g.Column,{width:8,children:y(A,{as:"h2",color:"teal",textAlign:"center",children:[h(C,{src:"/logo.png"})," Arketyper"]})}),h(g.Column,{width:4,children:h("div",{style:{textAlign:"right"},children:y(_,{closeIcon:!0,open:e,trigger:h(D,{link:!0,name:"info circle",size:"large"}),onClose:()=>t(!1),onOpen:()=>t(!0),children:[y(A,{children:[h(D,{name:"info circle"}),"Arketyper 1.0.0-beta"]}),y(_.Content,{children:[y("p",{children:["Arketyper is designed to gradually improving typing skill on unfamiliar keyboards. See ",h("a",{href:"https://github.com/p33t/arketyper/blob/master/docs/index.md",children:"Online Documentation"})," for more information."]}),y("p",{children:["This is an open-source project ",h("a",{href:"https://github.com/p33t/arketyper",children:"hosted on GitHub"})," and is a ",h("a",{href:"https://www.freshcode.biz",children:"freshcode.biz"})," innovation."]})]})]})})})]}),y(g.Row,{children:[h(g.Column,{width:5,children:h(M,{children:h(ae,{})})}),h(g.Column,{width:6,children:h(le,{})}),h(g.Column,{width:5,children:h(ce,{})})]}),h(g.Row,{children:y(g.Column,{children:[h(A,{children:h(m.Radio,{toggle:!0,onClick:()=>r(ee()),label:"100 Key Challenge"})}),n&&h(se,{})]})})]})})}const ue=N({reducer:{main:te}});R.render(h(E.StrictMode,{children:h(S,{store:ue,children:h(de,{})})}),document.getElementById("root"));
